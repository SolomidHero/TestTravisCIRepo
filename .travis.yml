language: python
jobs:
    include: 
        - stage: lint
          name: "Python 2.7 lint"
          python: "2.7"
          script: python -m flake8
        - stage: lint
          name: "Python 3.6 lint"
          python: "3.6"
          script: python -m flake8
        - stage: test
          python: "2.7"
          name: "Python 2.7 tests"
          script: PYTHONPATH=. pytest tests
        - stage: test
          name: "Python 3.6 tests"
          python: "3.6"
          script: PYTHONPATH=. pytest tests
        - stage: build_wheel
          name: "Build Wheel"
          script: python setup.py bdist_wheel
          python: "3.6"
          deploy:
              provider: releases
              skip_cleanup: true
              api_key: ${GITHUB_TOKEN}
              file_glob: true
              file:
                  - "dist/*.whl"
notifications:
    slack: ${SLACK_CREDENTIALS}
stages:
    - lint
    - test
    - name: build_wheel
      if: branch = master
